<link rel="import" href="../core-toolbar/core-toolbar.html">
<link rel="import" href="../core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../core-header-panel/core-header-panel.html">
<link rel="import" href="../core-icon-button/core-icon-button.html">
<link rel="import" href="../jukapp-bottom-sheet/jukapp-bottom-sheet.html">

<polymer-element name="jukapp-scaffold" attributes="queue">
  <template>

  <style>

  :host {
    display: block;
  }

  [drawer] {
    background-color: #fff;
    box-shadow: 1px 0 1px rgba(0, 0, 0, 0.1);
  }

  [main] {
    height: 100%;
    background-color: #eee;
  }

  core-toolbar {
    background-color: #526E9C;
    color: #fff;
  }

  #drawerPanel:not([narrow]) #menuButton {
    display: none;
  }

  .bottom-sheet {
    position: fixed;
    background: white;
    height: 64px;
    bottom: 0;
    right: 0;
    transition: left ease-in-out 0.3s;
  }
  .bottom-sheet-content {
    height: 100%;
  }
  .bottom-sheet-row {
    padding-top: 8px;
    padding-bottom: 8px;
    padding-left: 16px;
    padding-right: 16px;
    height: 48px;
  }
  .bottom-sheet-content span {
    opacity: 0.87;
    padding-left: 16px;
    padding-right: 16px;
  }
  .bottom-sheet-content span.index-number {
    opacity: 0.54;
    width: 24px;
    height: 24px;
    display: inline-block;
  }

  </style>

  <core-drawer-panel id="drawerPanel" narrow="{{narrow}}" drawerWidth="{{drawerWidth}}" rightDrawer="{{rightDrawer}}" responsiveWidth="{{responsiveWidth}}" disableSwipe="{{disableSwipe}}">

    <div vertical layout drawer>

      <content select="[navigation], nav"></content>

    </div>

    <core-header-panel id="headerPanel" main mode="{{mode}}">

      <core-toolbar>
        <template if="{{!rightDrawer}}">
          <paper-icon-button id="menuButton" icon="menu" on-tap="{{togglePanel}}"></paper-icon-button>
        </template>
        <content select="[tool]"></content>
        <template if="{{rightDrawer}}">
          <paper-icon-button id="menuButton" icon="menu" on-tap="{{togglePanel}}"></paper-icon-button>
        </template>
      </core-toolbar>

      <content select="*"></content>

      <jukapp-bottom-sheet drawerWidth="{{drawerWidth}}" narrow={{narrow}} queue={{queue}}></jukapp-bottom-sheet>
    </core-header-panel>

  </core-drawer-panel>

</template>
<script>

  Polymer('jukapp-scaffold', {

    /**
    * Fired when the main content has been scrolled.  `event.detail.target` returns
    * the scrollable element which you can use to access scroll info such as
    * `scrollTop`.
    *
    *     <jukapp-scaffold on-scroll="{{scrollHandler}}">
    *       ...
    *     </jukapp-scaffold>
    *
    *
    *     scrollHandler: function(event) {
    *       var scroller = event.detail.target;
    *       console.log(scroller.scrollTop);
    *     }
    *
    * @event scroll
    */

    publish: {

      /**
      * Width of the drawer panel.
      *
      * @attribute drawerWidth
      * @type string
      * @default '256px'
      */
      drawerWidth: '256px',

      /**
      * When the browser window size is smaller than the `responsiveWidth`,
      * `core-drawer-panel` changes to a narrow layout. In narrow layout,
      * the drawer will be stacked on top of the main panel.
      *
      * @attribute responsiveWidth
      * @type string
      * @default '600px'
      */
      responsiveWidth: '600px',

      /**
      * If true, position the drawer to the right. Also place menu icon to
      * the right of the content instead of left.
      *
      * @attribute rightDrawer
      * @type boolean
      * @default false
      */
      rightDrawer: false,

      /**
      * If true, swipe to open/close the drawer is disabled.
      *
      * @attribute disableSwipe
      * @type boolean
      * @default false
      */
      disableSwipe: false,

      /**
      * Used to control the header and scrolling behaviour of `core-header-panel`
      *
      * @attribute mode
      * @type string
      * @default 'seamed'
      */
      mode: {value: 'seamed', reflect: true},
      queue: []
    },

    ready: function() {
      this._scrollHandler = this.scroll.bind(this);
      this.$.headerPanel.addEventListener('scroll', this._scrollHandler);
    },

    detached: function() {
      this.$.headerPanel.removeEventListener('scroll', this._scrollHandler);
    },

    /**
    * Toggle the drawer panel
    * @method togglePanel
    */
    togglePanel: function() {
      this.$.drawerPanel.togglePanel();
    },

    /**
    * Open the drawer panel
    * @method openDrawer
    */
    openDrawer: function() {
      this.$.drawerPanel.openDrawer();
    },

    /**
    * Close the drawer panel
    * @method closeDrawer
    */
    closeDrawer: function() {
      this.$.drawerPanel.closeDrawer();
    },

    /**
    * Returns the scrollable element on the main area.
    *
    * @property scroller
    * @type Object
    */
    get scroller() {
      return this.$.headerPanel.scroller;
    },

    scroll: function(e) {
      this.fire('scroll', {target: e.detail.target}, this, false);
    },

  });

</script>
</polymer-element>
