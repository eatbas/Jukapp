<link rel="import" href="../core-toolbar/core-toolbar.html">
<link rel="import" href="../core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../core-header-panel/core-header-panel.html">
<link rel="import" href="../core-icon-button/core-icon-button.html">

<polymer-element name="jukapp-bottom-sheet" attributes="drawerWidth narrow queue">
  <template>

  <style>

  .bottom-sheet {
    position: fixed;
    background: white;
    bottom: 0;
    right: 0;
    max-height: {{ drawerHeight }};
  }
  .transition {
    transition: left ease-in-out 0.3s, height ease-in-out 0.3s;
  }
  .bottom-sheet-content {
    height: 100%;
    width: 100%;
  }
  .bottom-sheet-row {
    height: 48px;
    padding-top: 8px;
    padding-bottom: 8px;
  }
  .bottom-sheet-content .element {
    opacity: 0.87;
    padding-left: 16px;
    padding-right: 16px;
    width: 24px;
    height: 24px;
    display: inline-block;
  }
  .bottom-sheet-content .last-element {
    opacity: 0.87;
    padding-right: 16px;
    display: inline-block;
  }
  .bottom-sheet-content span.secondary {
    opacity: 0.54;
  }
  paper-button {
    padding: 0px;
    margin: 0px;
    text-align: left;
    text-transform: none;
  }
  paper-button /deep/ .button-content {
    padding: 0px;
  }

</style>

  <div id="drawer" class="bottom-sheet {{ { 'transition': !dragging } | tokenList }}" vertical layout _style="left: {{ narrow ? '0px' : drawerWidth }}; height: {{ isHidden ? '0px' : fullyExpanded ? drawerHeight : rowHeight }}">
    <paper-button flex noink on-tap="{{togglePanel}}">
      <div class="bottom-sheet-content">
        <template repeat="{{ video, index in queue }}">
          <div class="bottom-sheet-row" horizontal relative layout flex center>
            <template if="{{ index == 0 }}">
              <core-icon icon="{{ fullyExpanded ? 'expand-more' : 'expand-less' }}" class="element secondary"></core-icon>
            </template>
            <template if="{{ index != 0 }}">
              <span class="element"></span>
            </template>
            <span class="element secondary">{{ index+1 }}</span>
            <span flex>{{ video.title }}</span>
            <span class="last-element secondary">{{ durationFromSeconds(video.length) }}</span>
          </div>
        </template>
      </div>
    </paper-button>
  </div>

</template>
<script>

  Polymer('jukapp-bottom-sheet', {

    publish: {
      dragging: false,
      fullyExpanded: false,
      drawerHeight: "384px",
      rowHeight: "64px",
      queue: [],
      isHidden: true
    },

    eventDelegates: {
      trackstart: 'trackStart',
      tracky: 'tracky',
      trackend: 'trackEnd',
    },

    queueChanged: function() {
      this.isHidden = this.queue.length == 0;
    },

    togglePanel: function() {
      this.fullyExpanded = !this.fullyExpanded;
    },

    translateYForDeltaY: function(deltaY) {
      var baseHeight = 64;
      return Math.max(baseHeight, this.drawerStartHeight - deltaY);;
    },

    trackStart: function(e) {
      this.drawerStartHeight = this.$.drawer.offsetHeight;
      this.dragging = true;
      e.preventTap();
    },

    tracky : function(e) {
      this.moveDrawer(this.translateYForDeltaY(e.dy));
    },

    trackEnd: function(e) {
      this.dragging = false;
      if (e.yDirection < 0) {
        this.fullyExpanded = true;
        this.$.drawer.style.height = this.drawerHeight;
      } else {
        this.fullyExpanded = false;
        this.$.drawer.style.height = this.rowHeight;
      }
    },

    moveDrawer: function(translateY) {
      this.$.drawer.style.height = translateY + 'px';
    },

    durationFromSeconds: function(sec)
    {
      var date = new Date(0,0,0);
      date.setSeconds(+sec);
      return date.getMinutes()+':'+(date.getSeconds() < 10 ? '0' : '')+date.getSeconds();
    }

  });

</script>
</polymer-element>
