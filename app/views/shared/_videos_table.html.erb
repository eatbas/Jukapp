<% if true %>
<% videos.each_with_index do |video, index| %>
  <div class="table-row">
    <paper-shadow>
      <core-toolbar class="table-row-toolbar">
        <span flex><%= truncate(video.title, length: 54) %></span>
        <%= form_tag queue_video_path(youtube_id: video.youtube_id, title: video.title), method: :post, remote: true do %>
          <paper-icon-button icon="add" class="add-queue"></paper-icon-button>
        <% end %>
        <% if user_signed_in? && ( !local_variables.include?(:hide_favorites) || !hide_favorites ) %>
          <% if favorite?(video.youtube_id) %>
            <%= form_tag favorites_path(youtube_id: video.youtube_id, title: video.title), method: :delete, remote: true do %>
              <paper-icon-button icon="star" class="remove-favorite-button"></paper-icon-button>
            <% end %>
          <% else %>
            <%= form_tag favorites_path(youtube_id: video.youtube_id, title: video.title), method: :post, remote: true do %>
              <paper-icon-button icon="star-outline" class="add-favorite-button"></paper-icon-button>
            <% end %>
          <% end %>
        <% end %>
      </core-toolbar>
    </paper-shadow>
  </div>
<% end %>
<% else %>
<table class="table table-hover">
  <thead>
    <tr>
      <th class="text-center">#</th>
      <th class="text-center">Title</th>
      <th></th>
      <% if user_signed_in? && ( !local_variables.include?(:hide_favorites) || !hide_favorites ) %>
        <th></th>
      <% end %>
    </tr>
  </thead>
  <% videos.each_with_index do |video, index| %>
    <tr>
      <td>
        <%= index_with_page(index, params[:page]) %>
      </td>
      <td>
      </td>
      <td>
        <%= link_to "Add", queue_video_path(youtube_id: video.youtube_id, title: video.title), method: :post, remote: true, class: "btn btn-primary add-queue" %>
      </td>
      <% if user_signed_in? && ( !local_variables.include?(:hide_favorites) || !hide_favorites ) %>
        <td>
          <% if favorite?(video.youtube_id) %>
            <%= link_to favorites_path(youtube_id: video.youtube_id), method: :delete, remote: true, class: "btn btn-default remove-favorite-button" do %>
              <span class="glyphicon glyphicon-star"></span>
            <% end %>
          <% else %>
            <%= link_to favorites_path(youtube_id: video.youtube_id, title: video.title), method: :post, remote: true, class: "btn btn-default add-favorite-button" do %>
              <span class="glyphicon glyphicon-star-empty"></span>
            <% end %>
          <% end %>
        </td>
      <% end %>
    </tr>
  <% end %>
</table>
<% end %>

<script>
  $(function() {
    $(".add-favorite-button").click(function() {
      $(this).closest("form").submit();
      $(this).attr("disabled", "disabled");
      $(this).attr("icon", "star");
    });

    $(".remove-favorite-button").click(function() {
      $(this).closest("form").submit();
      $(this).attr("disabled", "disabled");
      $(this).attr("icon", "star-outline");
    });

    $(".add-queue").click(function() {
      $(this).closest("form").submit();
      $(this).attr("disabled", "disabled");
    });

  });
</script>
